# Meta-analysis

To assess the strength of the ME effect as well moderating factors, we conducted a meta-analysis on the existing body of literature  investigating the ME effect.

```{r}
ME_DATA_PATH <- here("data/0_metaanalysis_data.csv")
ma_raw <- read_csv(ME_DATA_PATH) %>%
  select(1:4, 6:16, 18, 19, 21, 27:29, 31:34, 48:50, 59) %>%
  mutate_if(is.character, as.factor)

AVG_MONTH <- 30.43688
ma_c <- ma_raw %>%
  mutate(mean_age = mean_age_1/AVG_MONTH,
         year = as.numeric(str_sub(short_cite, -5, -2)),
         condition_type = as.factor(ifelse(infant_type == "typical" & ME_trial_type == "FN", "TFN", 
                                 ifelse(infant_type == "typical" & ME_trial_type == "NN", "TNN", 
                                        as.character(infant_type)))),
         row_id = 1:n()) 
   #filter(!(study_ID %in% c("williams2009", "frank1999"))) # for checking that holds when exclude dissertations 

# see outliers.Rmd for analysis excluding outliers
```

## Methods

### Search strategy
We conducted a forward search based on citations of Markman and Wachtel (1988) in Google Scholar, and by using the keyword combination 'mutual exclusivity' in Google Scholar (retrieved September 2013; November 2017).\footnote{Data and analysis code for this and subsequent studies are available in an online repository at: \url{https://github.com/mllewis/me_vocab}} Additional papers were identified through citations and by consulting experts in the field. We then narrowed our sample to the subset of studies that used one of two different paradigms: (a) an experimenter says a novel word in the context of a familiar object and a novel object and the child guesses the intended referent (the canonical paradigm; "Familiar-Novel"), or (b) experimenter first provides the child with an unambiguous mapping of a novel label to a novel object, and then introduces a second novel object and asks the child to identify the referent of a second novel label ("Novel-Novel"). For Familiar-Novel conditions, we included conditions that used more than one familiar object (e.g. Familiar-Familiar-Novel). From these conditions, we restricted our sample to only those that satisfied the following criteria: (a) participants were children (less than 12 years of age),\footnote{This cutoff was arbitrary but allowed us to include conditions from older children from non-typically-developing populations.} (b) referents were objects or pictures (not facts or object parts), (c) no incongruent cues (e.g. eye gaze at familiar object) and (d) children had visual access to the objects (versus exclusively touch). All papers used either forced-choice pointing or eye-tracking methodology. All papers were peer-reviewed with the exception of two dissertations (Williams, 2009; Frank, I., 1999). In total, we identified `r length(unique(ma_c$study_ID))` papers that satisfied our selection criteria and had sufficient information to calculate an effect size. Papers included in the meta-analysis are marked with an asterick in the bibliography.

### Coding
For each paper, we coded separately each relevant condition with each age group entered as a separate condition. For each condition, we coded the paper metadata (citation) as well as several potential moderator variables: mean age of infants, estimates of mean vocabulary size of the sample population from the Words and Gestures form of the MacArthur-Bates Communicative Development Inventory when available [MCDI; @fenson1994variability;@fenson2007macarthur], and participant population type.\footnote{We also coded a number of other moderating variables not included here: method (eyetracking or pointing), number of alternatives in the forced choice task, and task modality (paper vs. object). See http://metalab.stanford.edu/ for these analyses.} We used production vocabulary as our estimate of vocabulary size since it was available for more studies in our sample. We coded participant population as one of three subpopulations that have been studied in the literature: (a) typically-developing monolingual children, (b) multilingual children (including both bilingual and trilingual children), and (c) non-typically developing children. Non-typically developing conditions included children with selective language impairment, language delays, hearing impairment, autism spectrum disorder, and Down Syndrome.

In order to estimate effect size for each condition, we coded sample size, proportion novel-object selections, baseline (e.g., .5 in a 2-AFC paradigm), standard deviations for novel object selections, *t*-statistic, and Cohen's *d*, where available. For several conditions, there was insufficient data reported in the main text to calculate an effect size (no means and standard deviations, *t*-statistics, or Cohen's *d*s), but we were able to estimate the means and standard deviations though measurement of plots (*N* = `r count(ma_c, data_source) %>% filter(data_source == "figure") %>% select(n) %>% as.numeric()`), imputation from other data within the paper (*N* = `r count(ma_c, data_source) %>% filter(data_source == "paper - some calculations") %>% select(n) %>% as.numeric()`), or through contacting authors (*N* = `r count(ma_c, data_source) %>% filter(data_source == "paper/author") %>% select(n) %>% as.numeric()`). Our final sample included `r length(ma_c$d_calc)` effect sizes (*N*~typical-developing~ = `r count(ma_c, infant_type) %>% filter(infant_type == "typical") %>% select(n) %>% as.numeric()`; *N*~multilingual~ = `r count(ma_c, infant_type) %>% filter(infant_type == "multilingual") %>% select(n) %>% as.numeric()`;  *N*~non-typically-developing~ = `r count(ma_c, infant_type) %>% filter(infant_type == "NT") %>% select(n) %>% as.numeric()`).

### Statistical approach
We calculated effect sizes (Cohen's *d*) from reported means and standard deviations where available, otherwise we relied on reported test-statistics (*t* or *d*). Effect sizes were computed by a script, `compute_es.R`, available in the Github repository. All analyses were conducted with the metafor package in R [@Rmetafor] using multi-level random effect model with grouping by paper and participant group (for conditions with the same or overlapping participant samples).\footnote{The exact model specification was as follows: \texttt{metafor::rma.mv(y = effect.size, V = effect.size.var, random =  $\sim$ 1 |  paper\textbackslash participant.group)}.} In models with moderators, moderators variables were included as additive fixed effects. Age was entered as logarithmic in months (where one month equals 30.44 days) to facilitate interpretation. All estimate ranges are 95% confidence intervals.

## Results


```{r get_MA_models}
get_MA_params <- function(this_condition_type, age_moderated, df) {
  
  if (this_condition_type == "grand"){
    this_data <- df
  } else {
      this_data  <- filter(df, condition_type == this_condition_type)
  }
  
  n = nrow(this_data)
  
  if (age_moderated){
      model <- rma.mv(d_calc ~ log(mean_age), V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                      data = this_data)
      
      this_age_estimate <- model$b[2]
      this_age_estimate.cil <- model$ci.lb[2]
      this_age_estimate.cih <- model$ci.ub[2]
      this_age_z <- model$zval[2]
      this_age_p <- model$pval[2]

  } else {
      model <- rma.mv(d_calc, V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                      data = this_data)
      
      this_age_estimate <- NA
      this_age_estimate.cil <- NA
      this_age_estimate.cih <- NA
      this_age_z <- NA
      this_age_p <- NA
    
  }
  
  params <- data.frame(condition_type = this_condition_type,
                       age_moderated = age_moderated,
                       n = n,
                       estimate = model$b[1],
                       estimate.cil = model$ci.lb[1],
                       estimate.cih = model$ci.ub[1],
                       z = model$zval[1],
                       p = model$pval[1],
                       age_estimate = this_age_estimate,
                       age_estimate.cil = this_age_estimate.cil, 
                       age_estimate.cih = this_age_estimate.cih,
                       age_z = this_age_z,
                       age_p = this_age_p,
                       Q = model$QE,
                       Qp = model$QEp)
}

model_pairs <- expand.grid(condition_type = c("grand",
                            as.character(unique(ma_c$condition_type))), 
                           age_moderated = c(TRUE, FALSE),
                           stringsAsFactors = F)

all_models <- map2_df(model_pairs$condition_type, 
                      model_pairs$age_moderated, 
                      get_MA_params, ma_c) 

# tidy variables for printing in ms
mod_print <- all_models %>%
             mutate(esimate_print =  round(estimate, 2),
                    CI_print = paste0(" [", 
                                      round(estimate.cil, 2),
                                     ", ",
                                     round(estimate.cih, 2),
                                     "]"),
                   estimate_print_full = paste(esimate_print, CI_print),
                   z_print = round(z, 2),
                   p_print = round(p, 2),
                   p_print = ifelse(p_print <.001, "<.001", paste0("= ", p_print)),
                   age_estimate_print = round(age_estimate, 2),
                   age_CI_print = paste0(" [", 
                                      round(age_estimate.cil, 2),
                                     ", ",
                                     round(age_estimate.cih, 2),
                                     "]"),
                   age_estimate_print_full = paste(age_estimate_print, age_CI_print),

                   age_z_print =  round(age_z, 2),
                   age_p_print =  round(age_p, 2),
                   age_p_print = ifelse(age_p_print < .001, "<.001", 
                                        paste0("= ", age_p_print)),
                   Q_print = round(Q, 2),
                   Qp_print = round(Qp, 2),
                   Qp_print = ifelse(Qp_print < .001, "<.001", paste0("= ", Qp_print)))
```


In a model with all conditions in our sample, we estimated the overall ME effect size to be `r filter(mod_print, condition_type == "grand", !age_moderated)$estimate_print`, and reliably greater than zero (*p* `r filter(mod_print, condition_type == "grand", !age_moderated)$p_print`; Figure 1).\footnote{Three conditions were more than three standard deviations beyond the overall mean effect size (two typically developing FN conditions and one non-typically developing condition). These outliers contributed to heteroskedasticity in our sample (Breusch Pagan test: $\chi^2$(1)= 11.95, {\it p} < .001).  With these outliers excluded (Lipsey \& Wilson, 2001), the heteroskedasticity was reduced ($\chi^2$(1)= .13, {\it p} = .72) and the overall effect size (1.22 [0.96, 1.48]) was slightly smaller, but qualitatively the same. Given that we have no theoretical reason to exclude these conditions, we have included all conditions in our analyses presented here.}

We next conducted a separate meta-analysis for four theoretically-relevant conditions: Familiar-Novel trials with typically developing participants, Novel-Novel trials with typically developing participants, conditions with multilingual participants, and conditions with non-typically developing participants. 


### Typically-Developing Population: Familiar-Novel Trials
We first examined effect sizes of ME for typically-developing children in the canonical familiar-novel paradigm. This is the central data point that theories of ME must explain.

```{r, forest_prep}
forest_model_data <- mod_print %>%
                          filter(!age_moderated) %>%
                          rename(model_name = condition_type) %>%
                          mutate(model_type = ifelse(model_name == "grand",
                                 "grand", "sub"),
                                 model_name = fct_relevel(model_name,
                                                          "TFN", 
                                                          "TNN", 
                                                          "multilingual", 
                                                          "NT", 
                                                          "grand"),
                                 model_name = fct_rev(model_name))

 breaks <- seq(-.25, 2.5, .25)
 labels <- as.character(breaks)
 labels[!(breaks%%1==0)] <- ''
 tick.sizes <- rep(.5, length(breaks))
 tick.sizes[(breaks%%1==0)] <- 1
```

```{r, fig.pos = "!t", fig.cap = "Mixed-effect effect size estimates for all conditions (red) and each of the four theoretically-relevant conditions in our sample. Ranges are 95 percent confidence intervals. Point size corresponds to sample size. FN = Familiar-Novel trials; NN = Novel-Novel trials." , fig.height = 3, fig.width = 9}
p1 <- ggplot(forest_model_data, 
             aes(x = model_name, 
                 y = estimate, 
                 color = model_type)) +
  geom_vline(xintercept = 0) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  geom_point(aes(size = n)) +
  geom_linerange(aes(ymin = estimate.cil, 
                     ymax = estimate.cih)) +
  geom_text(aes(label = estimate_print_full, x = model_name, y = 3.25), 
            size = 4) +
  coord_flip() 

p1 <- p1 + scale_shape_manual(values = c(16, 15)) +
  scale_color_manual(values = c( '#FF0000', "#000000")) +
  scale_size_continuous(guide = FALSE) +
  scale_y_continuous(breaks = breaks, 
                     labels = labels,
                     limits = c(-.25, 3.75),
                     name = "Effect Size") +
  scale_x_discrete(labels = c("NT" = "Non-Typically-Developing populations (FN/NN)", 
                              "grand" = "Overall estimate",
                              "TFN" = "Typically-Developing populations (FN trials)",
                              "TNN" = "Typically-Developing populations (NN trials)",
                              "multilingual" = "Multilingual populations (FN/NN)"),
                   name = "") + 
  ggtitle("Mixed-effect estimates of overall effect size") 

p1 <- p1 + 
  theme_bw() +
  theme(axis.line.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.background = element_blank(),
        legend.position = "none",
        axis.ticks.x = element_line(size = tick.sizes),
        axis.ticks.y = element_blank(),
        axis.text.x = element_text(size = 11), 
        axis.text.y = element_text(size = 11, 
                                   colour = c('red', rep('black', 4)),
                                   face = c("bold", rep("plain", 4))),
        plot.title = element_text(size = 12, face = "bold"),
        axis.title = element_text(size = 12))
p1
```

The overall effect size for these conditions was `r filter(mod_print, condition_type == "TFN", !age_moderated)$estimate_print`, and reliably greater than zero (*p* `r filter(mod_print, condition_type == "TFN", !age_moderated)$p_print`; Figure 1). The effect sizes contained considerable heterogeneity, however (*Q* = `r filter(mod_print, condition_type == "TFN", !age_moderated)$Q_print`; *p* `r filter(mod_print, condition_type == "TFN", !age_moderated)$p_print`). 


```{r MA_model_table}
age <- mod_print %>%
  filter(age_moderated) %>%
  select(condition_type, age_estimate_print_full, age_z_print, age_p) %>%
  mutate(term = "age") %>%
  select(condition_type, term, everything()) %>%
  rename(estimate_print_full = age_estimate_print_full, 
          z_print =  age_z_print,
          p = age_p)

intercept <- mod_print %>%
  filter(age_moderated) %>%
  select(condition_type, n, estimate_print_full, z_print, p) %>%
  mutate(term = "intercept") 

print_age_table_data <- bind_rows(intercept, age) %>%
    arrange(condition_type) %>%
    select(condition_type, term, everything()) %>%
    mutate(p = ifelse(p < .01, "<.01", round(p, 2)))  %>%
    mutate(condition_type = ifelse(term == "age", "", condition_type)) %>%
    select(condition_type, n, everything()) %>%
    mutate(n = ifelse(is.na(n), "", n),
           condition_type = as.factor(condition_type), 
          condition_type = fct_recode(condition_type,
                                      `Non-Typically-Developing populations (FN/NN)` = "NT", 
           `Overall estimate` = "grand",
           `Typically-Developing populations (FN trials)`  = "TFN",
           `Typically-Developing populations (NN trials)` = "TNN",
           `Multilingual populations (FN/NN)` =   "multilingual"))
  
print_age_table_data <- print_age_table_data[c(1,2,7,8,9,10,3,4,5,6),]
colnames(print_age_table_data) <- c("Model", "n", "term", "estimate [CI]", "Z", "p")
```

```{r, results = "asis"}
apa_table(print_age_table_data, caption = "Meta-analytic model parameters for model including age as a fixed effect. Beta weights for the age term indicate the amount of change in effect size for an additional log month of age. The first model (top) estimates effect sizes for all studies in our sample. The four subsequent models present separate models parameters for four separate conditions. Ranges are 95 percent confidence intervals.", small = T, note = "n = sample size (number of studies); FN = Familiar-Novel; NN = Novel-Novel.")
```


```{r age_and_vocab_TFN}
age_vocab_corr <- ma_c %>%
  filter(condition_type == 'TFN') %>%
  do(tidy(cor.test(.$mean_age, .$mean_production_vocab)))

d_calc_vocab_corr <- ma_c %>%
  filter(condition_type == 'TFN') %>%
  do(tidy(cor.test(.$d_calc, .$mean_production_vocab)))

num_vocab_conditions <- ma_c %>%
  filter(condition_type == 'TFN',
         !is.na(mean_production_vocab)) %>%
  nrow()

age_vocab_model <- rma.mv(d_calc ~ log(mean_age) + mean_production_vocab, 
                          V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                       data = filter(ma_c, condition_type == 'TFN'))

# age_vocab_model params
av_a_beta <- round(age_vocab_model$beta[2],2)
av_v_beta <- round(age_vocab_model$beta[3],4) # more digits because 0, if else
av_a_zval <- round(age_vocab_model$zval[2],2)
av_v_zval <- round(age_vocab_model$zval[3],2)
av_a_pval <- ifelse(round(age_vocab_model$pval[2],2)  < .0001,
                    "<.0001", paste0(" = ", round(age_vocab_model$pval[2],2)))
av_v_pval <- ifelse(round(age_vocab_model$pval[3],2)  < .0001,
                    "<.0001", paste0(" = ", round(age_vocab_model$pval[3],2)))

# vocab model
vocab_data <- ma_c %>%
  filter(condition_type == 'TFN') 

vocab_model <- rma.mv(d_calc ~ mean_production_vocab, V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                      data = vocab_data)

vocab_model_params <- data.frame(
                       v_estimate = vocab_model$b[2],
                       v_z = vocab_model$zval[2],
                       v_p = vocab_model$pval[2]) %>%
                    mutate(
                       v_estimate_print = round(v_estimate, 3),
                       v_z_print =  round(v_z, 2),
                       v_p_print =  round(v_p, 2),
                       v_p_print = ifelse(v_p_print < .001, "<.001", 
                                            paste0("= ", v_p_print))) %>%
                    select(v_estimate_print, v_z_print, v_p_print)
```

We next tried to predict this heterogeneity with two moderators corresponding to developmental change: age and vocabulary size. In a model with age as a moderator, age was a reliable predictor of effect size ($\beta$ = `r filter(mod_print, condition_type == "TFN", age_moderated)$age_estimate_print`, *Z* = `r filter(mod_print, condition_type == "TFN", age_moderated)$age_z_print`, *p* `r filter(mod_print, condition_type == "TFN", age_moderated)$age_p_print`; see Table 1), suggesting that the ME effect becomes larger as children get older (Figure 2). For the conditions for which we had estimates of vocabulary size (*N* = `r num_vocab_conditions`), age of participants was highly correlated with vocabulary size in our sample (*r* = `r round(age_vocab_corr$estimate,2)`, *p* < .01). In a model with only vocabulary as a moderator, vocabulary was also a reliable predictor of effect size ($\beta$ = `r printnum(vocab_model_params$v_estimate_print, digits = 3)`, *Z* = `r vocab_model_params$v_z_print`, *p* `r vocab_model_params$v_p_print`).  Next we asked whether vocabulary size predicted independent variance in the magnitude of the ME effect. To test this, we fit a model with both age and vocabulary size as moderators.  In this model, neither vocabulary size ($\beta$ = `r  printnum(av_v_beta, digits = 3)`, *Z* = `r av_v_zval`,  *p* `r av_v_pval`)  nor age ($\beta$ = `r av_a_beta`, *Z* = `r av_a_zval`,  *p* `r av_a_pval`) was a reliable predictor of ME effect size, likely due in part to the high intercorrelation between the two predictors.

These analyses confirm that the ME effect is robust, and associated with a very large effect size (*d* = `r filter(mod_print, condition_type == "TFN", !age_moderated)$estimate_print`) relative to other experimental psychology phenomena [@bosco2015correlational; @open2015estimating]. They also suggest that the magnitude of the effect strengthens over development. Vocabulary size, though correlated with age, does not predict additional effect size variance over and above age. This finding is difficult to interpret however, given the fact that estimates of vocabulary size are likely far less accurate than those of age, and we likely have less power to detect an effect of vocabulary size relative to age, since estimates of vocabulary size are available for only a minority of conditions (`r round(num_vocab_conditions/ nrow(filter(ma_c,condition_type == 'TFN')),2) * 100`%).

### Typically-Developing Population: Novel-Novel Trials
One way that vocabulary knowledge could lead to increased performance on the Familiar-Novel ME task is through increased certainty about the label associated with the familiar word: If a child is more certain that a ball is called "ball," then the child should be more certain that the novel label applies to the novel object. Novel-Novel trials control for potential variability in certainty about the familiar object by teaching participants a new label for a novel object prior to the critical ME trial, where this previously-learned label becomes the "familiar" object in the ME task.  If knowledge of the familiar object is not the only contributor to age-related changes in the ME effect, then there should be an increase in the magnitude of the ME effect in Novel-Novel trials, as well as Familiar-Novel trials. In addition, if the strength of knowledge of the "familiar" object influences the strength of the ME effect, then the overall effect size should be smaller for Novel-Novel trials, compared to Familiar-Novel trials.

For conditions with the Novel-Novel trial design, the overall effect size was `r filter(mod_print, condition_type == "TNN", !age_moderated)$estimate_print` and reliably greater than zero (*p* `r filter(mod_print, condition_type == "TNN", !age_moderated)$p_print`).  We next asked whether age predicted some of the variance in these trials by fitting a model with age as a moderator. Age was a reliable predictor of effect size ($\beta$ = `r filter(mod_print, condition_type == "TNN", age_moderated)$age_estimate_print`, *Z* = `r filter(mod_print, condition_type == "TNN", age_moderated)$age_z_print`, *p* `r filter(mod_print, condition_type == "TNN", age_moderated)$age_p_print`), suggesting that the strength of the ME effect increases with age. There were no Novel-Novel conditions in our dataset where the mean vocabulary size of the sample was reported, and thus we were not able to examine the moderating role of vocabulary size on this trial type.

```{r age_and_TFN_vs_TNN}
TFN_NNN_model <- rma.mv(d_calc ~ log(mean_age) + ME_trial_type, V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                      data = filter(ma_c,infant_type == 'typical'))

# TFN_NNN_model params
at_a_beta <- round(TFN_NNN_model$beta[2],2)
at_t_beta <- round(TFN_NNN_model$beta[3],2)
at_a_zval <- round(TFN_NNN_model$zval[2],2)
at_t_zval <- round(TFN_NNN_model$zval[3],2)
at_a_pval <- ifelse(round(TFN_NNN_model$pval[2],2)  < .0001,
                    "<.0001", paste0(" = ", round(TFN_NNN_model$pval[1],2)))
at_t_pval <- ifelse(round(TFN_NNN_model$pval[3],2)  < .0001, 
                    "<.0001", paste0(" = ", round(TFN_NNN_model$pval[2],2)))
```

Finally, we fit a model with both age and trial type (Familiar-Novel or Novel-Novel) as moderators of the ME effect. Both moderators predicted independent variance in ME effect size (age: $\beta$ = `r at_a_beta`, *Z* = `r at_a_zval`,  *p* `r at_a_pval`; trial type: $\beta$ = `r at_t_beta`, *Z* = `r at_t_zval`,  *p* `r at_t_pval`), with Familiar-Novel conditions and conditions with older participants tending to have larger effect sizes.

These analyses suggest that both development (either via maturation or experience-related changes) as well as the strength of the familiar word representation are related to the strength of the ME effect. A successful theory of ME will need to account for both of these empirical facts.

### Multilingual Population
We next turn to a different population of participants: Children who are simultaneously learning multiple languages. This population is of theoretical interest because it allows us to isolate the influence of linguistic knowledge from the influence of domain-general capabilities. If the ME effect relies on mechanisms that are domain-general and independent of linguistic knowledge, then we should expect the magnitude of the effect to be the same for multilingual children compared to monolingual children. 

```{r mono_vs_multi}
mono_vs_multi_model <- rma.mv(d_calc ~ log(mean_age) + infant_type, V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                      data = filter(ma_c, infant_type != 'NT'))

# mono_vs_multi_model params
ml_a_beta <- round(mono_vs_multi_model$beta[2],2)
ml_lt_beta <- round(mono_vs_multi_model$beta[3],2)
ml_a_zval <- round(mono_vs_multi_model$zval[2],2)
ml_l_zval <- round(mono_vs_multi_model$zval[3],2)
ml_a_pval <- ifelse(round(mono_vs_multi_model$pval[2],2)  < .0001, "<.0001", 
                    paste0(" = ", round(mono_vs_multi_model$pval[2],2)))
ml_l_pval <- ifelse(round(mono_vs_multi_model$pval[3],2)  < .0001, "<.0001", 
                    paste0(" = ", round(mono_vs_multi_model$pval[3],2)))
```

Children learning multiple languages did not reliably show the ME effect in a model not controlling for age (*d* = `r filter(mod_print, condition_type == "multilingual", !age_moderated)$estimate_print_full`). We next fit a model with both monolingual (typically-developing)  and multilingual participants, predicting effect size with language status (monolingual vs. multilingual), while controlling for age.  Both language status ($\beta$ = `r ml_lt_beta`, *Z* = `r ml_l_zval`,  *p* `r ml_l_pval`) and age ($\beta$ = `r ml_a_beta`, *Z* = `r ml_a_zval`,  *p* `r ml_a_pval`) were reliable predictors of effect size: Being monolingual and older were each predictive of a larger effect size. 

These data provide some evidence that language-specific knowledge influences the magnitude of the ME bias, consistent with the experimental work with multilinguals. 

### Non-Typically-Developing Population
Finally, we examine a third-population of participants: non-typically developing children. This group includes children with diagnoses of Autism-Spectrum Disorder (ASD), Down Syndrome , Late-Talker, Selective Language Impairment, and deaf/hard-of-hearing. While this sample is highly heterogeneous, we group them together due to the sparsity of data on any single non-typical population. These populations are of theoretical interest because they allow us to observe how impairment to a particular aspect of cognition influences the magnitude of the ME effect. For example, children with ASD are thought to have impaired social reasoning skills [e.g., @phillips1998understanding]; thus, if children with ASD are able to succeed on the ME task, to a first approximation this information might suggest that social reasoning skills are not critically involved in making ME inferences [@preissler2005role; @de_Marchena_2011]. As a heterogeneous group, these studies can provide evidence about the extent to which the ME behavior is robust to developmental differences. 

Overall, non-typically developing children succeeded on the ME task  (*d* = `r filter(mod_print, condition_type == "NT", !age_moderated)$estimate_print_full`). In a model with age as a moderator, age was a reliable predictor of the effect, suggesting children became more accurate with age, as with other populations ($\beta$ = `r filter(mod_print, condition_type == "NT", age_moderated)$age_estimate_print`, *Z* = `r filter(mod_print, condition_type == "NT", age_moderated)$age_z_print`, *p* `r filter(mod_print, condition_type == "NT", age_moderated)$age_p_print`). We were not able to examine the potential moderating role of  vocabulary size for this population because there were only `r filter(ma_c, !is.na(mean_production_vocab), condition_type == "NT") %>% nrow()` conditions where mean vocabulary size was reported. 


```{r typical_vs_non_typical}
T_vs_NT_model <- rma.mv(d_calc ~ log(mean_age) + infant_type, V = d_var_calc,
                      random = ~ 1 | short_cite/same_infant,
                      method = "REML",
                      data = filter(ma_c, infant_type != 'multilingual'))

# TFN_NNN_model params
tnta_a_beta <- round(T_vs_NT_model$beta[2],2)
tnta_tnt_beta <- round(T_vs_NT_model$beta[3],2)
tnta_a_zval <- round(T_vs_NT_model$zval[2],2)
tnta_tnt_zval <- round(T_vs_NT_model$zval[3],2)
tnta_a_pval <- ifelse(round(T_vs_NT_model$pval[2],2)  < .0001, "<.0001", paste0(" = ", round(T_vs_NT_model$pval[2],2)))
tnta_tnt_pval <- ifelse(round(T_vs_NT_model$pval[3],2)  < .0001, "<.0001", paste0(" = ", round(T_vs_NT_model$pval[3],2)))
```

We also asked whether the effect size for non-typically developing children differed from typically-developing children, controlling for age. We fit a model predicting effect size with both development type (typical vs. non-typical) and age. Population type was a reliable predictor of effect size with non-typically developing children tending to have a smaller bias compared to typically developing children ($\beta$ = `r tnta_tnt_beta`, *Z* = `r tnta_tnt_zval`,  *p*  `r tnta_tnt_pval`). Age was also a reliable predictor of effect size in this model ($\beta$ = `r tnta_a_beta`, *Z* = `r tnta_a_zval`,  *p*  `r tnta_a_pval`).

This analysis suggests that non-typically developing children succeed in the ME paradigm just as typically developing children do, albeit at lower rates, and show the same broad developmental trajectory. Theoretical accounts of ME will need to account for how non-typically developing children are able to develop the ability to make the ME inference,  despite a range of different cognitive impairments. 

## Discussion

To summarize our meta-analytic findings, we find a robust ME effect in each of the three populations we examined, as well as  evidence that the magnitude of this effect increases across development. We also identified several factors that moderated the effect. Specifically, we find that the ME effect is larger (1) in the canonical Familiar-Novel paradigm compared to the Novel-Novel paradigm (though both designs show roughly the same developmental trajectory), and (2) for monolinguals relative to multilinguals. The magnitude of the paradigm effect (FN vs NN) was comparable in size to the multilingual effect (monolinguals vs. multilinguals).

Taken together, these analyses provide several theoretical constraints with respect to the mechanism underlying the ME effect. First, the strength of the bias increases across development, independent of the strength of the learner's knowledge of the "familiar" word. This constraint comes from the fact that the bias strengthens across development in the Novel-Novel conditions. Second, developmental change in the strength of the ME effect is observed for children across a variety of populations, suggesting that developmental change is a robust pattern and is related to the mechanism underlying the ME effect for different populations. 

```{r, fig.height = 7, fig.pos = '!t', fig.cap = "Developmental trajectory of ME effect as a function of four moderators tested in the meta-analysis.  For reference, the model fit for familiar-novel trials in typical populations is shown on each moderator plot (blue dash). Ranges correspond to 95% confidence intervals. Point size corresponds to sample size, and point shape corresponds to trial type (Familiar-Novel vs. Novel-Novel). Note that two points are omitted from plotting from the typical populations to maximize similarity of the x-axis, but the x-axis scale differs for the non-typical populations facet. Upper tick marks show year milestones.  B = bilingual; T = trilingual; LT = late-talker; ASD = autism spectrum disorder; DS = Down Syndrome; SLI = selective language impairment; DHH = deaf/hard-of-hearing. Data can be explored interactively at http://metalab.stanford.edu/."}

ma_plotting <- ma_c %>%
  mutate(es_type = ifelse(infant_type2 != "typical",
                          "Non-Typical Populations",
                          ifelse(ME_trial_type == "NN", 
                                 "Novel-Novel", "Familiar-Novel")),
         es_type = ifelse(es_type == "Non-Typical Populations" &  
                            infant_type2 %in% c("bilingual", "trilingual"), 
                          "Multi-Lingual", 
                          ifelse(es_type == "Non-Typical Populations", 
                                 "Non-Typical Populations",
                                 es_type)),
        es_type = fct_relevel(es_type, "Familiar-Novel", "Novel-Novel"),

         infant_type2_label = ifelse(infant_type2 == "typical",
                                     "", as.character(infant_type2)),
         infant_type2_label = fct_recode(infant_type2_label, 
                                         LT = "late_talkers", 
                                         DHH = "deaf/hard-of-hearing", 
                                         B = "bilingual", 
                                         `T` = "trilingual",
                                         MR = "youth with mental retardation"),
         d_var_calc2 = ifelse(es_type == "Non-Typical Populations", 
                                d_var_calc, 0),
         d_calc2 = ifelse(es_type == "Non-Typical Populations", 
                                d_calc, 0),
         d_var_calc2 = d_var_calc,
         d_calc2 = d_calc,
         effects.cil = d_calc2 -
               qnorm(.05 / 2, lower.tail = FALSE) * sqrt(d_var_calc2),
         effects.cih = d_calc2 +
               qnorm(.05 / 2, lower.tail = FALSE) * sqrt(d_var_calc2)) %>%
         filter(mean_age < 75 | es_type == "Non-Typical Populations")

NF_only <- ma_plotting %>%
  filter(infant_type2 == "typical",
         ME_trial_type == "FN") %>%
  select(d_calc, mean_age)

all_FN <- mutate(NF_only, 
                 es_type = "Familiar-Novel", 
                 line_group = 1) %>%
          bind_rows(mutate(NF_only, 
                           es_type = "Novel-Novel",
                           line_group = 2)) %>%
          bind_rows(mutate(NF_only, 
                           es_type = "Non-Typical Populations",
                           line_group = 2)) %>%
          bind_rows(mutate(NF_only, 
                           es_type = "Multi-Lingual",
                           line_group = 2)) %>%
          mutate(es_type = fct_relevel(es_type, "Familiar-Novel", "Novel-Novel"))

NN_NT_only <- ma_plotting %>%
  mutate(d_calc = ifelse(infant_type2 == "typical" & 
                            ME_trial_type  == "FN", NA, d_calc),
         mean_age = ifelse(infant_type2 == "typical" & 
                            ME_trial_type  == "FN", NA, mean_age),
         es_type = fct_relevel(es_type, "Familiar-Novel", "Novel-Novel")) %>%
  select(study_ID, d_calc, mean_age, infant_type2, ME_trial_type, es_type) 

gline = linesGrob(y = c(-.05, .02),  gp = gpar(col = "black", lwd = 1.5)) 

ma_faceted_plot <- ma_plotting %>%
  ggplot(aes(x = mean_age, y = d_calc)) +
    facet_wrap(~ es_type, scale = "free_x", 2) +
    geom_hline(aes(yintercept = 0)) +
    geom_linerange(aes(ymin = effects.cil, ymax = effects.cih), 
                   alpha = .5, size = .3) +
    geom_point(aes(size = n_1, shape = ME_trial_type), alpha = .5) +
    geom_smooth(aes(linetype = as.factor(line_group)), 
                method = "lm", 
                formula = y ~ log(x),
                color = "#268bd2",
                data = all_FN, se = FALSE, size = 1.1) +
    geom_smooth(aes(y = d_calc, x = mean_age, color = es_type), 
                method = "lm", 
                formula = y ~ log(x), 
                data = NN_NT_only, se = FALSE, size = 1.1) +
    scale_color_manual(values= c("#b58900", "#d33682", "#6c71c4"), guide = FALSE) +
    ggrepel::geom_text_repel(aes(label = infant_type2_label), box.padding = .5) +
    scale_shape_discrete(name = "Trial Type",
                         labels = c("Familiar-Novel", "Novel-Novel")) +
    scale_size_continuous(name = "Sample size") +
    guides(linetype = FALSE,
           shape = guide_legend(override.aes = list(size = 4))) +
    xlab("Mean age (months)") +
    ylab("Effect size (d)") +
    ggtitle("Mutual Exclusivity across Development from Meta-Analytic Data") +
    theme_classic()  +
    theme(legend.position = "bottom")  +
    annotation_custom(gline, xmin=12, xmax=12, ymin=-Inf, ymax=Inf) +
    annotation_custom(gline, xmin=24, xmax=24, ymin=-Inf, ymax=Inf) +
    annotation_custom(gline, xmin=36, xmax=36, ymin=-Inf, ymax=Inf) +
    annotation_custom(gline, xmin=48, xmax=48, ymin=-Inf, ymax=Inf) +
    annotation_custom(gline, xmin=60, xmax=60, ymin=-Inf, ymax=Inf) +
    annotation_custom(gline, xmin=72, xmax=72, ymin=-Inf, ymax=Inf)

ma_faceted_plot <- ggplotGrob(ma_faceted_plot)
grid.draw(ma_faceted_plot)

# save typical only for ES size calculation for Exp 1
typical_only <- ma_c %>%
  filter(infant_type == "typical") %>%
   rename(age_months = mean_age,
          trial_type = ME_trial_type) %>%
  select(d_calc, age_months, trial_type, mean_production_vocab)
#write_csv(typical_only, here("data/0_metaanalysis_data_typical_only.csv"))
```

```{r longtidinal_vocab_studies_from_meta}
ma_c <- ma_raw %>%
  filter(!is.na(d_calc)) %>%
  mutate(mean_age = mean_age_1/AVG_MONTH,
         year = as.numeric(str_sub(short_cite, -5, -2)),
         condition_type = as.factor(ifelse(infant_type == "typical" & ME_trial_type == "FN", "TFN", 
                                 ifelse(infant_type == "typical" & ME_trial_type == "NN", "TNN", 
                                        as.character(infant_type))))) %>%
  filter(mean_age < 150) 

vocab_studies <- ma_c %>%
  filter(infant_type == "typical")%>%
  filter(!is.na(mean_production_vocab) ) %>% 
  count(study_ID)  

#1 bion2013         1
#2 byers2009        1
#3 graham1998       1
#4 horst2008        3
#5 horst2010        3
#6 markman2003      8
#7 mather2009       4
#8 williams2009     2

vocab_studies_by_age <- ma_c %>%
  filter(infant_type == "typical")%>%
  filter(!is.na(mean_production_vocab) ) %>% 
  mutate(mean_age = round(mean_age,0)) %>%
  distinct(study_ID, mean_age, expt_num) %>%
  count(study_ID, expt_num) %>%
  distinct(study_ID, .keep_all = T) %>%
  filter(n > 1)

#1 horst2010                3
#2 markman2003              2
#4 mather2009               2
#5 williams2009             2
```

There is also some evidence that language experience accounts for developmental change on the basis of the fact that we see a larger effect size in Familiar-Novel trials compared to Novel-Novel trials, and a larger effect size in monolinguals relative to multilinguals. Nevertheless, the meta-analytic approach is limited in its ability to measure the relationship between linguistic experience and developmental change since few studies in our sample measure vocabulary size (*N* = `r nrow(vocab_studies)`), and even fewer measure vocabulary size at multiple ages within the same study (*N* = `r nrow(vocab_studies_by_age)`; Horst, Scott, & Pollard, 2010a; Mather & Plunkett, 2009a; A.\ Williams, 2009). In the next section,  we use experimental methods to more directly examine the relationship between linguistic experience and the ME effect.

```{r, eval = F}
#  [*N* = `r nrow(vocab_studies_by_age)`, @mather2009learning;  @williams2009; @horst2010role]
```
